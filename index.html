<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan d'Investissement FMB Transmobilit√© Services 2025 - Premium</title>
    <!-- Chargement de Tailwind CSS pour un style moderne et responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Police Inter pour la lisibilit√© -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .section-title {
            position: relative;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .section-title::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 4px;
            background-color: #0d9488; /* Teal 600 */
            border-radius: 9999px;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-3px);
        }
        .loading-animation {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d9488;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Navbar de navigation -->
    <nav class="bg-gray-900 text-white sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <span class="text-xl font-bold text-teal-300">FMB Invest 2025</span>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4 text-sm font-medium">
                        <a href="#presentation" class="hover:bg-gray-700 px-3 py-2 rounded-md">Pr√©sentation</a>
                        <a href="#formules" class="hover:bg-gray-700 px-3 py-2 rounded-md">Formules</a>
                        <a href="#personnalise" class="hover:bg-gray-700 px-3 py-2 rounded-md bg-teal-600">Mon Plan LLM</a>
                        <a href="#modeles" class="hover:bg-gray-700 px-3 py-2 rounded-md">Mod√®les & Roadmap</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <header class="bg-gray-900 text-white py-6 shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-extrabold tracking-tight">
                üìò PLAN D‚ÄôINVESTISSEMENT FMB TRANSMOBILIT√â SERVICES
            </h1>
            <p class="mt-2 text-xl font-medium text-teal-300">Version Premium (Texte Complet) - Devenez un investisseur du futur.</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">

        <!-- Section 1 : Pr√©sentation -->
        <section id="presentation" class="mb-16">
            <h2 class="section-title text-3xl font-bold text-gray-900">1. Pr√©sentation de FMB Transmobilit√© Services</h2>
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <p class="text-lg mb-4 leading-relaxed">
                    **FMB Transmobilit√© Services** est une entreprise de transport moderne, structur√©e et digitalis√©e, sp√©cialis√©e dans l'optimisation de vos actifs de transport.
                </p>
                <div class="mt-6">
                    <h3 class="text-xl font-semibold text-teal-700 mb-3">Nos Domaines d'Expertise :</h3>
                    <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                        <li>La gestion de v√©hicules (bus, minibus, voitures Yango, Heetch)</li>
                        <li>L‚Äôaccompagnement √† l‚Äôachat s√©curis√© et certifi√©</li>
                        <li>La gestion compl√®te et professionnelle des chauffeurs</li>
                        <li>Le suivi digital des revenus et des d√©penses en temps r√©el</li>
                        <li>L‚Äôinvestissement partag√© dans les flottes de transport</li>
                    </ul>
                </div>
                <blockquote class="mt-6 p-4 border-l-4 border-teal-500 bg-teal-50 rounded-r-lg">
                    <p class="text-xl font-semibold text-teal-800">
                        <span class="mr-2 text-2xl">üëâ</span> Notre objectif : Permettre √† toute personne ‚Äî au S√©n√©gal ou dans la diaspora ‚Äî d‚Äôinvestir dans un secteur <span class="text-teal-700 font-extrabold">rentable, s√ªr et transparent.</span>
                    </p>
                </blockquote>
            </div>
        </section>

        <!-- Section 2 : Vision & Rentabilit√© -->
        <section class="mb-16 grid md:grid-cols-2 gap-8">
            <!-- Vision -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg card">
                <h2 class="section-title text-2xl font-bold text-gray-900">2. Notre Vision</h2>
                <p class="mb-4 text-gray-700">
                    Cr√©er la premi√®re plateforme d‚Äôinvestissement transport en Afrique de l‚ÄôOuest, bas√©e sur :
                </p>
                <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                    <li>La transparence et la s√©curit√© maximales</li>
                    <li>Des donn√©es r√©elles et v√©rifiables</li>
                    <li>Des revenus stables et mesurables</li>
                    <li>Une gestion professionnelle et digitalis√©e</li>
                </ul>
                <p class="mt-4 text-lg font-medium text-teal-700">
                    Nous permettons d'investir, m√™me avec un petit capital **(√† partir de 500 000 FCFA)**.
                </p>
            </div>

            <!-- Rentabilit√© -->
            <div class="bg-teal-700 text-white p-6 md:p-8 rounded-xl shadow-lg card">
                <h2 class="section-title text-2xl font-bold text-white after:bg-white">3. Pourquoi le transport est rentable au S√©n√©gal ?</h2>
                <div class="space-y-3">
                    <p class="text-lg font-light">Le S√©n√©gal conna√Æt :</p>
                    <ul class="list-disc list-inside space-y-2 ml-4 font-light">
                        <li>Une forte urbanisation et un besoin croissant de mobilit√©</li>
                        <li>La mont√©e en puissance des VTC (Yango, Heetch)</li>
                        <li>Un manque de solutions de gestion professionnelles (votre opportunit√©)</li>
                        <li>Une demande √©norme de la diaspora pour des investissements s√©curis√©s</li>
                    </ul>
                </div>
                <div class="mt-6 p-4 bg-teal-900 rounded-lg text-center">
                    <p class="text-4xl font-extrabold text-yellow-300">üî• 20% √† 40%</p>
                    <p class="text-lg font-semibold mt-1">Rentabilit√© moyenne par an</p>
                    <p class="text-sm font-light italic mt-2">Bien plus √©lev√©e que l‚Äôimmobilier ou les placements bancaires traditionnels.</p>
                </div>
                <!-- Ajout d'une carte graphique de comparaison pour la rentabilit√© -->
                <div class="mt-4 text-center">
                    <p class="text-sm font-medium text-teal-200 mb-2">Comparatif de Rendement Annuel :</p>
                    
                </div>
            </div>
        </section>

        <!-- Section 4 : Nos Garanties -->
        <section class="mb-16">
            <h2 class="section-title text-3xl font-bold text-gray-900">4. Nos Garanties : L'Investissement Sans Stress</h2>
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border-t-4 border-teal-500">
                <p class="text-xl font-medium mb-6">
                    FMB g√®re tout pour vous assurer tranquillit√© d'esprit et performance.
                </p>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="font-bold text-teal-600">S√©curit√© Juridique</p>
                        <ul class="text-sm mt-1 space-y-1 text-gray-700">
                            <li>Contrats l√©gaux (SARL)</li>
                            <li>Assurance v√©hicule compl√®te</li>
                            <li>Structure cr√©dible pour banques</li>
                        </ul>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="font-bold text-teal-600">Transparence Digitale</p>
                        <ul class="text-sm mt-1 space-y-1 text-gray-700">
                            <li>Dashboard de suivi (digital)</li>
                            <li>Reporting mensuel d√©taill√©</li>
                            <li>GPS et suivi en temps r√©el</li>
                        </ul>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="font-bold text-teal-600">Gestion Op√©rationnelle</p>
                        <ul class="text-sm mt-1 space-y-1 text-gray-700">
                            <li>Gestion chauffeur & maintenance</li>
                            <li>Acc√®s s√©curis√© investisseurs</li>
                            <li>FMB s‚Äôoccupe de tout le stress</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5 : Formules d'Investissement -->
        <section id="formules" class="mb-16">
            <h2 class="section-title text-3xl font-bold text-gray-900">5. Nos Formules d‚ÄôInvestissement</h2>

            <div class="grid lg:grid-cols-3 gap-8">

                <!-- Formule 1 -->
                <div class="card bg-white p-6 rounded-xl border-l-4 border-teal-500 shadow-md">
                    <h3 class="text-2xl font-bold text-teal-700 mb-3">FORMULE 1 : Gestion Assist√©e</h3>
                    <p class="text-sm font-semibold text-gray-600 mb-4">(Le client apporte son v√©hicule)</p>
                    <ul class="text-sm space-y-2 text-gray-700">
                        <li class="flex items-start"><span class="text-teal-500 mr-2 text-xl">‚úîÔ∏è</span>Pour qui ? Propri√©taires fatigu√©s des chauffeurs, Diaspora.</li>
                        <li class="flex items-start"><span class="text-teal-500 mr-2 text-xl">‚úîÔ∏è</span>FMB g√®re : Planning Yango, chauffeur, entretien, assurance, versements.</li>
                        <li class="flex items-start"><span class="text-teal-500 mr-2 text-xl">‚úîÔ∏è</span>**R√©partition : 80% Investisseur / 20% FMB.**</li>
                        <li class="font-bold mt-2 text-green-700">Revenus moyens : **250 000 √† 400 000 FCFA / mois.**</li>
                    </ul>
                </div>

                <!-- Formule 2 -->
                <div class="card bg-white p-6 rounded-xl border-l-4 border-orange-500 shadow-md">
                    <h3 class="text-2xl font-bold text-orange-700 mb-3">FORMULE 2 : Accompagnement Achat</h3>
                    <p class="text-sm font-semibold text-gray-600 mb-4">(FMB aide √† acheter le v√©hicule)</p>
                    <ul class="text-sm space-y-2 text-gray-700">
                        <li class="flex items-start"><span class="text-orange-500 mr-2 text-xl">‚úîÔ∏è</span>FMB s‚Äôoccupe de : Choix du mod√®le, diagnostic moteur, achat et transport.</li>
                        <li class="flex items-start"><span class="text-orange-500 mr-2 text-xl">‚úîÔ∏è</span>Objectif : √âviter arnaques, v√©hicules non fiables, r√©parations inutiles.</li>
                        <li class="flex items-start"><span class="text-orange-500 mr-2 text-xl">‚úîÔ∏è</span>Mise en route : Installation, chauffeur, Yango ou transport classique.</li>
                        <li class="font-bold mt-2 text-orange-700">**Frais FMB : 150 000 √† 250 000 FCFA (forfait unique).**</li>
                    </ul>
                </div>

                <!-- Formule 3 -->
                <div class="card bg-white p-6 rounded-xl border-l-4 border-blue-500 shadow-md">
                    <h3 class="text-2xl font-bold text-blue-700 mb-3">FORMULE 3 : Investissement Capital</h3>
                    <p class="text-sm font-semibold text-gray-600 mb-4">(Tu investis un montant, FMB ach√®te le v√©hicule)</p>
                    <ul class="text-sm space-y-2 text-gray-700">
                        <li class="flex items-start"><span class="text-blue-500 mr-2 text-xl">‚úîÔ∏è</span>Fonctionnement : Vous investissez un montant (ex : 1M FCFA), FMB compl√®te.</li>
                        <li class="flex items-start"><span class="text-blue-500 mr-2 text-xl">‚úîÔ∏è</span>Gestion : FMB g√®re enti√®rement le v√©hicule et l'exploitation.</li>
                        <li class="flex items-start"><span class="text-blue-500 mr-2 text-xl">‚úîÔ∏è</span>Revenus : Proportionnels √† votre capital investi.</li>
                        <li class="font-bold mt-2 text-blue-700">Id√©al diaspora : Investissement sans stress, revenu mensuel.</li>
                    </ul>
                </div>

            </div>

            <!-- Formules Sp√©cialis√©es -->
            <div class="mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 mt-8">Formules Sp√©cialis√©es pour Fort Potentiel</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Formule 4 -->
                    <div class="p-5 bg-teal-50 rounded-xl border border-teal-200">
                        <p class="font-bold text-lg text-teal-800">FORMULE 4 : Pack Diaspora ‚úàÔ∏è</p>
                        <p class="text-sm mt-1 text-gray-600">Investissement 100% √† distance. Id√©al France, USA, Canada, etc.</p>
                        <ul class="list-disc list-inside ml-2 mt-2 text-sm text-gray-700">
                            <li>Achat + mise en route cl√© en main</li>
                            <li>**Versement via Wave, WU, banque.**</li>
                        </ul>
                    </div>
                    <!-- Formule 5 -->
                    <div class="p-5 bg-teal-50 rounded-xl border border-teal-200">
                        <p class="font-bold text-lg text-teal-800">FORMULE 5 : Fleet Fund (Collectif) üë•</p>
                        <p class="text-sm mt-1 text-gray-600">Investissement collectif dans un ou plusieurs v√©hicules.</p>
                        <ul class="list-disc list-inside ml-2 mt-2 text-sm text-gray-700">
                            <li>Capital minimum accessible **(500k FCFA)**.</li>
                            <li>Id√©al pour tontines, groupes d'amis.</li>
                        </ul>
                    </div>
                    <!-- Formule 6 -->
                    <div class="p-5 bg-teal-50 rounded-xl border border-teal-200">
                        <p class="font-bold text-lg text-teal-800">FORMULE 6 : Investissement Minibus / Bus üöå</p>
                        <p class="text-sm mt-1 text-gray-600">Tr√®s forte rentabilit√© et revenu mensuel stable.</p>
                        <ul class="list-disc list-inside ml-2 mt-2 text-sm text-gray-700">
                            <li>Minimum : **2 000 000 FCFA** (FMB compl√®te).</li>
                            <li>Revenus moyens : **500 000 √† 800 000 FCFA / mois.**</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nouveau: G√©n√©rateur de Plan Personnalis√© LLM -->
        <section id="personnalise" class="mb-16 py-10 bg-teal-900 text-white rounded-xl shadow-2xl">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-extrabold text-teal-300 mb-4 text-center">
                    Cr√©er mon Plan Personnalis√© ‚ú®
                </h2>
                <p class="text-center mb-8 text-lg font-light">
                    Recevez une recommandation strat√©gique bas√©e sur les 6 formules d'investissement FMB, adapt√©e √† votre capital et votre profil.
                </p>
                
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="capital" class="block text-sm font-medium text-teal-200 mb-2">Capital Initial (FCFA)</label>
                        <input type="number" id="capital" value="1000000" min="500000" step="100000" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white focus:ring-teal-500 focus:border-teal-500" placeholder="Ex: 1 000 000">
                    </div>
                    <div class="md:col-span-2">
                        <label for="riskProfile" class="block text-sm font-medium text-teal-200 mb-2">Profil de Risque</label>
                        <select id="riskProfile" class="w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white focus:ring-teal-500 focus:border-teal-500">
                            <option value="Faible - Je privil√©gie la s√©curit√© et un revenu stable.">Faible (S√©curit√© & Stabilit√©)</option>
                            <option value="Mod√©r√© - Je cherche un √©quilibre entre croissance et risque.">Mod√©r√© (√âquilibre)</option>
                            <option value="√âlev√© - Je suis pr√™t(e) √† prendre des risques pour une rentabilit√© maximale.">√âlev√© (Max. Rentabilit√©)</option>
                        </select>
                    </div>
                </div>

                <div class="text-center">
                    <button id="generatePlanBtn" onclick="generateInvestmentPlan()" class="inline-flex items-center justify-center w-full md:w-auto px-8 py-3 text-lg font-bold text-gray-900 bg-teal-300 rounded-full hover:bg-teal-200 transition duration-300 shadow-xl">
                        Analyser et G√©n√©rer mon Plan ‚ú®
                    </button>
                </div>

                <!-- Zone de r√©sultat et chargement -->
                <div id="planResult" class="mt-8 p-6 bg-gray-800 rounded-xl border border-teal-500 hidden">
                    <div id="loadingIndicator" class="hidden justify-center items-center space-x-3">
                        <div class="loading-animation"></div>
                        <span class="text-teal-400 font-semibold">Analyse en cours...</span>
                    </div>
                    <div id="planText" class="text-gray-200 space-y-4">
                        <!-- Le texte g√©n√©r√© par Gemini sera ins√©r√© ici -->
                    </div>
                </div>
            </div>
        </section>


        <!-- Section 8 & 9 : Conclusion & Roadmap -->
        <section class="mb-16">
            <h2 class="section-title text-3xl font-bold text-gray-900">8. Conclusion</h2>
            <div class="bg-gray-800 text-white p-6 md:p-8 rounded-xl shadow-2xl">
                <p class="text-xl font-light mb-4">
                    FMB Transmobilit√© Services offre une solution simple, rentable et professionnelle pour investir dans le transport au S√©n√©gal.
                </p>
                <blockquote class="p-4 border-l-4 border-teal-300 bg-gray-700 rounded-r-lg">
                    <p class="text-xl font-semibold text-teal-300">
                        Notre mission : Permettre aux S√©n√©galais et √† la diaspora d‚Äôinvestir dans un secteur essentiel, <span class="font-extrabold">sans risques inutiles ni mauvaise gestion.</span>
                    </p>
                </blockquote>

                <h3 class="text-2xl font-bold text-teal-300 mt-8 mb-4 section-title after:bg-teal-300">9. Notre Feuille de Route (Roadmap)</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                    <span class="bg-gray-700 p-3 rounded-lg flex items-center shadow-inner">‚ú® Plateforme web d‚Äôinvestissement</span>
                    <span class="bg-gray-700 p-3 rounded-lg flex items-center shadow-inner">üìä Dashboards financiers avanc√©s</span>
                    <span class="bg-gray-700 p-3 rounded-lg flex items-center shadow-inner">üõí Marketplace de v√©hicules certifi√©s</span>
                    <span class="bg-gray-700 p-3 rounded-lg flex items-center shadow-inner">üõ°Ô∏è Assurance FMB d√©di√©e</span>
                    <span class="bg-gray-700 p-3 rounded-lg flex items-center shadow-inner">üöú Investissement agricole + logistique</span>
                    <span class="bg-gray-700 p-3 rounded-lg flex items-center shadow-inner">üöò Leasing intelligent</span>
                </div>
            </div>
        </section>

        <!-- Call to Action -->
        <section class="text-center py-12 bg-teal-50 rounded-xl border border-teal-200 shadow-inner">
            <h2 class="text-3xl font-extrabold text-teal-800 mb-4">Pr√™t √† investir dans l'avenir du transport ?</h2>
            <p class="text-xl text-teal-700 mb-6">
                Contactez FMB Transmobilit√© Services d√®s aujourd'hui pour d√©marrer votre placement.
            </p>
            <a href="#" class="inline-block px-8 py-3 text-lg font-bold text-white bg-teal-600 rounded-full hover:bg-teal-700 transition duration-300 shadow-lg">
                Demander plus d'informations
            </a>
            <p class="mt-4 text-sm text-gray-600">FIN DU DOCUMENT (Version Premium)</p>
        </section>

    </main>

    <footer class="bg-gray-900 text-gray-400 py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm">
            ¬© 2025 FMB Transmobilit√© Services. Tous droits r√©serv√©s.
        </div>
    </footer>

    <!-- Firebase and Gemini API setup (Necessary for the LLM feature) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the Canvas environment
        // NOTE: The actual API key is defined in the non-module script below for direct use in the LLM call.
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Initialize Firebase and Auth (Mandatory boilerplate)
        let auth;
        if (Object.keys(firebaseConfig).length) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            const db = getFirestore(app); // Initialize Firestore, even if not directly used here, for environment readiness

            // Sign in (using custom token if available, otherwise anonymously)
            if (initialAuthToken) {
                signInWithCustomToken(auth, initialAuthToken).catch(e => {
                    console.error("Firebase Custom Auth failed, signing in anonymously.", e);
                    signInAnonymously(auth);
                });
            } else {
                signInAnonymously(auth);
            }
        }
    </script>

    <!-- Script for the LLM Feature -->
    <script>
        const planResultDiv = document.getElementById('planResult');
        const planTextDiv = document.getElementById('planText');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const generatePlanBtn = document.getElementById('generatePlanBtn');
        
        // ATTENTION : Cette cl√© est maintenant ins√©r√©e. Assurez-vous qu'elle est s√©curis√©e (restrictions IP/Domaine).
        const apiKey = "AIzaSyAONvs3BJJVmyubLkaYcSi7mWMIYgyTX1s"; 
        
        const LLM_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const LLM_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${LLM_MODEL}:generateContent?key=${apiKey}`; 

        // Simple function to extract the full text of the investment plan from the HTML (sections 1-9)
        function getDocumentContentForLLM() {
            const sections = document.querySelectorAll('main > section');
            let content = "";
            sections.forEach(section => {
                // Exclude the LLM feature section itself and the Call to Action
                if (!section.classList.contains('bg-teal-900') && !section.classList.contains('text-center')) {
                    content += section.innerText.trim() + "\n\n---\n\n";
                }
            });
            // Add a clear instruction based on the section content structure
            return "Voici le Plan d'Investissement FMB Transmobilit√© Services, incluant la description d√©taill√©e des 6 Formules d'Investissement :\n\n" + content;
        }

        // Exponential backoff utility for API retries
        async function fetchWithExponentialBackoff(url, options, retries = 5, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // 429 is Too Many Requests
                        return response;
                    }
                    console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                } catch (error) {
                    if (i === retries - 1) throw error;
                    console.error("Fetch failed, retrying...", error);
                }
                await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 2;
            }
            throw new Error("API request failed after multiple retries.");
        }

        async function generateInvestmentPlan() {
            const capital = document.getElementById('capital').value;
            const riskProfile = document.getElementById('riskProfile').value;
            const documentContent = getDocumentContentForLLM();

            // Simple check to ensure the key isn't a placeholder (though the user already provided one)
            if (!apiKey) {
                planResultDiv.classList.remove('hidden');
                planTextDiv.innerHTML = '<p class="text-red-400 font-bold">Erreur de Configuration : La cl√© API Gemini est manquante.</p>';
                loadingIndicator.classList.add('hidden');
                generatePlanBtn.disabled = false;
                return;
            }
            
            if (!capital || capital < 500000) {
                planResultDiv.classList.remove('hidden');
                planTextDiv.innerHTML = '<p class="text-red-400 font-bold">Veuillez entrer un capital initial valide (minimum 500 000 FCFA).</p>';
                return;
            }

            // Show loading and disable button
            planResultDiv.classList.remove('hidden');
            planTextDiv.innerHTML = '';
            loadingIndicator.classList.remove('hidden');
            generatePlanBtn.disabled = true;

            const systemPrompt = `Agis comme un conseiller en investissement expert et objectif pour FMB Transmobilit√© Services. Ton objectif est de proposer un plan d'investissement initial concis (maximum 4 paragraphes courts), professionnel et motivant. Base-toi uniquement sur les 6 formules d'investissement du document.

            1. Analyse le capital et le profil de risque.
            2. Choisis la Formule FMB la plus pertinente (parmi 1 √† 6).
            3. D√©cris l'investissement recommand√© et explique bri√®vement pourquoi cette formule correspond √† l'investisseur.
            4. Utilise un ton encourageant et professionnel (en fran√ßais).
            5. Formate la sortie en Markdown en utilisant des titres de niveau 3 (###) pour la recommandation principale et le titre de niveau 4 (####) pour les points cl√©s, et en mettant en gras les chiffres importants.`;

            const userQuery = `Mon capital initial est de ${new Intl.NumberFormat('fr-FR').format(capital)} FCFA. Mon profil de risque est "${riskProfile}". 
            En utilisant UNIQUEMENT le document FMB ci-dessous, propose-moi la meilleure formule d'investissement FMB (parmi les 6 list√©es) et explique pourquoi.

            --- DOCUMENT FMB ---
            ${documentContent}
            --- FIN DU DOCUMENT FMB ---`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithExponentialBackoff(LLM_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                let text = "Erreur : La g√©n√©ration du plan a √©chou√©. Veuillez r√©essayer.";

                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                     text = result.candidates[0].content.parts[0].text;
                } else if (result.error) {
                    // Gestion des erreurs sp√©cifiques (par exemple, quota d√©pass√© ou cl√© invalide)
                    if (result.error.message.includes("API key not valid")) {
                         text = "Erreur : La cl√© API fournie n'est pas valide ou n'est plus active. Veuillez en g√©n√©rer une nouvelle.";
                    } else if (result.error.message.includes("quota")) {
                         text = "Erreur de Quota : Le nombre maximum d'appels √† l'API a √©t√© atteint pour aujourd'hui. Veuillez r√©essayer demain.";
                    } else {
                         text = `Erreur API: ${result.error.message}.`;
                    }
                }
                
                // Correction: Convertir le Markdown simple en HTML pour une meilleure lisibilit√©
                const formattedText = text
                    .replace(/###\s*(.*)/g, '<h3 class="text-xl font-bold text-teal-300 mt-4 mb-2">$1</h3>') // Titre 3
                    .replace(/####\s*(.*)/g, '<h4 class="text-lg font-semibold text-teal-400 mt-3 mb-1">$1</h4>') // Titre 4
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Mise en gras
                    .split('\n')
                    .map(line => line.startsWith('<h') ? line : line.trim() === '' ? '' : `<p>${line}</p>`)
                    .join('');


                planTextDiv.innerHTML = formattedText;

            } catch (error) {
                console.error("Gemini API call error:", error);
                planTextDiv.innerHTML = '<p class="text-red-400 font-bold">Une erreur de r√©seau s\'est produite (impossible d\'atteindre l\'API). Veuillez r√©essayer plus tard.</p>';
            } finally {
                loadingIndicator.classList.add('hidden');
                generatePlanBtn.disabled = false;
            }
        }
        
        window.generateInvestmentPlan = generateInvestmentPlan; // Expose to global scope for onclick
    </script>
</body>
</html>